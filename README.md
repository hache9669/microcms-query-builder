<h1 align="center">microcms-query-builder</h1>
<p>
  <a href="https://github.com/hache9669/microcms-query-builder/actions?query=workflow%3A%22Node.js+CI%22" target="_blank">
    <img alt="build status" src="https://github.com/hache9669/microcms-query-builder/workflows/build/badge.svg" />
  </a>
  <a href="https://www.npmjs.com/package/microcms-query-builder" target="_blank">
    <img alt="npm version" src="http://img.shields.io/npm/v/microcms-query-builder" />
  </a>
  <a href="https://www.npmjs.com/package/microcms-query-builder" target="_blank">
    <img alt="npm downloads" src="https://img.shields.io/npm/dt/microcms-query-builder" />
  </a>
  <a href="https://github.com/hache9669/microcms-query-builder/graphs/commit-activity" target="_blank">
    <img alt="maintenance" src="https://img.shields.io/badge/Maintained%3F-yes-green.svg" />
  </a>
  <a href="https://github.com/hache9669/microcms-query-builder/blob/master/LICENSE.txt" target="_blank">
    <img alt="license: MIT" src="https://img.shields.io/github/license/hache9669/microcms-query-builder" />
  </a>
</p>

### üè† [Homepage](https://github.com/hache9669/microcms-query-builder#readme)

## Motivation
Want to use an fully-typed Eloquent-like query builder on the Japanese headless CMS "[microCMS](https://microcms.io/)".

## Install
```sh
yarn add microcms-query-builder
```

## Usage
When you have those schema in your microCMS

| field id  | type                       | note                       |
|-----------|----------------------------|----------------------------|
| id        | string                     | auto generated by microCMS |
| name      | string                     |                            |
| quantity  | number?                    |                            |
| flag      | boolean                    |                            |
| createdAt | string(formatted datetime) | auto generated by microCMS |

then

```ts
import { 
  FilterBuilder, 
  MicroCMSQuery, 
  IFilterBuilder, 
  IMicroCMSQuery, 
  IMicroCMSSearchable 
} from 'microcms-query-builder';

interface YourSchema extends IMicroCMSSearchable {
  id: string;
  name: string;
  quantity: number;
  flag: boolean;
  createdAt: string;
}

const builder: IFilterBuilder = new FilterBuilder<YourSchema>();
const query: IMicroCMSQuery = builder.equals('name', 'Bob')
                     .exists('quantity')
                     .equals('flag', true)
                     .greaterThan('createdAt', '2020-01-01')
                     .toQuery();

const queryParams: string = query.toString();
// => 'filters=(name[equals]Bob)[and](quantity[exists])[and](flag[equals]true)[and](createdAt[greaterThan]2020-01-01)'
```

## Class and Methods
### MicroCMSQuery<YourSchema extends IMicroCMSSearchable> Class
Class representing the query parameters to be passed to the microCMS list-endpoints.
For more information, see [official document](https://microcms.io/docs/content-api/get-list-contents#h9ce528688c).

#### setters
All of properties are optional.
- draftKey(arg: string | undefined)
- limit(arg: number | undefined)
- offset(arg: number | undefined)
- orders(arg: { field: keyof YourSchema; sort: "asc" | "desc" }[] | undefined)
- q(arg: string | undefined)
- fields(arg: keyof YourSchema[] | undefined)
- ids(arg: string[] | undefined)
- filters(arg: IFilter<Schema> | undefined)
  - Pass the filter object created by FilterBuilder class.
- depth(arg: 1 | 2 | 3 | undefined)
### toParam()
Create query parameters as object.
```ts
axios.get('https://micro.microcms.io/api/v1/{endpoint}?', query.toParam());
```
#### toString()
Create query parameters as string.
```ts
axios.get('https://micro.microcms.io/api/v1/{endpoint}?' + query.toString());
```

### FilterBuilder<YourSchema extends IMicroCMSSearchable> Class
Class representing focused on "filters" property of query parameter.
For more information, see [official document](https://microcms.io/docs/content-api/get-list-contents#hdebbdc8e86).

#### equals
#### notEquals
#### lessThan
#### greaterThan
#### contains
#### exists
#### notExists
#### beginsWith
#### toFilter()
Return filter object, which can be passed to MicroCMSQuery::filters.

#### toQuery()
Directly create a instance of MicroCMSQuery class. Note that it does not contain any other properties like limit, offset, or else.

Each of these two processes has the same result;
```ts
const builder = new FilterBuilder<YourSchema>();
const query = builder.equals('flag', true).toQuery();
query.limit = 10;
```
or
```ts
const query = new MicroCMSQuery<YourSchema>();
const builder = new FilterBuilder<YourSchema>();
query.limit = 10;
query.filters = builder.equals('flag', true).toFilter();
```

## Disclaimer
- This project is under development. There are many missing features (contributions are welcome). For example, searching for custom fields and handling of Date.
- I'm not from microCMS, and therefore cannot be held responsible for keeping up with changes in the service's specifications.

## Author

üë§ **hache9669**

* Github: [@hache9669](https://github.com/hache9669)

## ü§ù Contributing

Contributions, issues and feature requests are welcome!<br />Feel free to check [issues page](https://github.com/hache9669/microcms-query-builder/issues). 

## Show your support

Give a ‚≠êÔ∏è if this project helped you!

## üìù License

Copyright ¬© 2020 [hache9669](https://github.com/hache9669).<br />
This project is [MIT](https://github.com/hache9669/microcms-query-builder/blob/master/LICENSE.txt) licensed.

***
_This README was generated with ‚ù§Ô∏è by [readme-md-generator](https://github.com/kefranabg/readme-md-generator)_